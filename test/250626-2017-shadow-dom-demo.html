<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shadow DOM 隔离测试页面</title>
    <link rel="stylesheet" href="../src/styles/design-tokens.css" />
    <link rel="stylesheet" href="../src/styles/global/essential.css" />
    <link rel="stylesheet" href="../src/styles/components.css" />
    <style>
      body {
        font-family: var(--lucid-font-family);
        background: var(--lucid-bg-primary);
        color: var(--lucid-text-primary);
        margin: 0;
        padding: 20px;
      }

      .demo-section {
        margin: 40px 0;
        padding: 20px;
        border: 1px solid var(--lucid-border-subtle);
        border-radius: var(--lucid-radius-md);
        background: var(--lucid-bg-secondary);
      }

      .demo-title {
        font-size: var(--lucid-font-size-lg);
        font-weight: var(--lucid-font-weight-semibold);
        margin-bottom: 16px;
        color: var(--lucid-text-primary);
      }

      .demo-button {
        background: var(--lucid-accent-primary);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: var(--lucid-radius-md);
        cursor: pointer;
        font-family: var(--lucid-font-family);
        font-size: var(--lucid-font-size-base);
        margin: 8px;
        transition: all var(--lucid-transition-fast);
      }

      .demo-button:hover {
        background: var(--lucid-accent-primary-hover);
      }

      .status-info {
        background: var(--lucid-bg-glass-light);
        padding: 12px;
        border-radius: var(--lucid-radius-sm);
        margin: 12px 0;
        border-left: 4px solid var(--lucid-accent-primary);
      }

      /* 宿主页面样式冲突测试 */
      .lucid-tooltip {
        /* 故意添加冲突样式 */
        background: red !important;
        color: yellow !important;
      }

      .lucid-toolfull {
        /* 故意添加冲突样式 */
        border: 5px solid red !important;
        background: yellow !important;
      }

      .lucid-transparent-popup {
        /* 故意添加冲突样式 */
        background: green !important;
        color: white !important;
      }

      /* 测试文本选择区域 */
      .test-text {
        line-height: 1.8;
        padding: 16px;
        background: var(--lucid-bg-tertiary);
        border-radius: var(--lucid-radius-md);
        margin: 16px 0;
        user-select: text;
      }

      .highlight-word {
        background: var(--lucid-accent-secondary);
        padding: 2px 4px;
        border-radius: var(--lucid-radius-sm);
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Shadow DOM 样式隔离测试页面</h1>

    <div class="status-info">
      <strong>测试目的：</strong>验证 lucid-tooltip、lucid-toolfull 和
      lucid-transparent-popup 的 Shadow DOM 样式隔离效果
    </div>

    <!-- 基础 Tooltip 测试 -->
    <div class="demo-section">
      <div class="demo-title">1. 基础 Tooltip 测试</div>
      <p>鼠标悬停在下面的单词上查看tooltip效果：</p>
      <div class="test-text">
        This is a
        <span class="highlight-word" data-word="example">example</span> sentence
        with some
        <span class="highlight-word" data-word="highlighted">highlighted</span>
        words that should trigger
        <span class="highlight-word" data-word="tooltips">tooltips</span> when
        you hover over them.
      </div>
      <button class="demo-button" onclick="createSimpleTooltip()">
        手动创建 Tooltip
      </button>
    </div>

    <!-- Tooltip Detail 测试 -->
    <div class="demo-section">
      <div class="demo-title">2. 详细信息弹窗测试</div>
      <p>点击单词查看详细信息弹窗：</p>
      <div class="test-text">
        Click on this
        <span
          class="highlight-word"
          data-word="beautiful"
          onclick="showTooltipDetail(event, 'beautiful')"
          >beautiful</span
        >
        word to see detailed information popup with definitions, pronunciations,
        and examples.
      </div>
      <button
        class="demo-button"
        onclick="showTooltipDetail(event, 'demonstration')"
      >
        显示详细弹窗
      </button>
    </div>

    <!-- 透明弹窗测试 -->
    <div class="demo-section">
      <div class="demo-title">3. 透明弹窗测试</div>
      <p>显示大型透明弹窗界面：</p>
      <button class="demo-button" onclick="toggleTransparentPopup()">
        切换透明弹窗
      </button>
      <button class="demo-button" onclick="showTransparentPopupAtPosition()">
        在指定位置显示
      </button>
    </div>

    <!-- 冲突样式提示 -->
    <div class="demo-section">
      <div class="demo-title">4. 样式冲突测试</div>
      <p class="status-info">
        <strong>注意：</strong>页面中故意添加了与组件同名的冲突CSS样式规则。
        如果Shadow DOM隔离生效，组件应该保持原有样式不受影响。
        如果看到红色、黄色、绿色等异常颜色，说明样式隔离失败。
      </p>
    </div>

    <script type="module">
      // 模拟导入相关模块
      let tooltipRenderer = null;
      let transparentPopupManager = null;

      // 初始化模拟数据
      const mockWordData = {
        word: "example",
        phonetic: { us: "/ɪɡˈzæmpəl/", uk: "/ɪɡˈzɑːmpəl/" },
        explain: [
          {
            pos: "noun",
            definitions: [
              { chinese: "示例，例子", chinese_short: "示例" },
              { chinese: "榜样，典型", chinese_short: "榜样" },
            ],
          },
        ],
      };

      // 创建简单 tooltip
      window.createSimpleTooltip = function () {
        console.log("创建简单 tooltip");

        // 模拟创建 tooltip 元素
        const tooltip = document.createElement("div");
        tooltip.className =
          "lucid-tooltip lucid-toolfull-base lucid-tooltip-container lucid-glass-primary";
        tooltip.innerHTML = `
                <div class="lucid-tooltip-content lucid-flex lucid-flex-center lucid-p-3">
                    <span class="lucid-text-primary lucid-font-medium">example</span>
                    <span class="lucid-text-secondary lucid-m-2">/ɪɡˈzæmpəl/</span>
                    <span class="lucid-text-primary">示例</span>
                </div>
            `;

        // 定位到页面中心
        tooltip.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 2147483647;
                opacity: 1;
                pointer-events: auto;
            `;

        document.body.appendChild(tooltip);

        // 3秒后自动移除
        setTimeout(() => {
          if (tooltip.parentNode) {
            tooltip.parentNode.removeChild(tooltip);
          }
        }, 3000);
      };

      // 显示详细信息弹窗
      window.showTooltipDetail = function (event, word) {
        console.log("显示详细信息弹窗:", word);

        const popup = document.createElement("div");
        popup.className =
          "lucid-toolfull lucid-toolfull-base lucid-glass-primary";
        popup.innerHTML = `
                <div class="lucid-flex lucid-flex-col lucid-p-6">
                    <div class="lucid-flex lucid-flex-between lucid-m-2">
                        <h3 class="lucid-text-xl lucid-font-semibold lucid-text-primary">${word}</h3>
                        <button class="lucid-btn lucid-btn-sm" onclick="this.closest('.lucid-toolfull').remove()">✕</button>
                    </div>
                    <div class="lucid-text-secondary lucid-m-1">/ɪɡˈzæmpəl/</div>
                    <div class="lucid-flex lucid-flex-col lucid-m-2">
                        <div class="lucid-text-sm lucid-text-tertiary">noun</div>
                        <div class="lucid-text-primary">示例，例子</div>
                        <div class="lucid-text-secondary lucid-text-sm lucid-m-1">榜样，典型</div>
                    </div>
                </div>
            `;

        // 定位到点击位置附近
        const rect = event.target.getBoundingClientRect();
        popup.style.cssText = `
                position: fixed;
                left: ${rect.left + 50}px;
                top: ${rect.bottom + 10}px;
                z-index: 2147483648;
                opacity: 1;
                transform: scaleY(1) translateY(0);
            `;

        document.body.appendChild(popup);
      };

      // 切换透明弹窗
      window.toggleTransparentPopup = function () {
        console.log("切换透明弹窗");

        let existingPopup = document.getElementById("lucid-transparent-popup");
        if (existingPopup) {
          existingPopup.remove();
          return;
        }

        const popup = document.createElement("div");
        popup.id = "lucid-transparent-popup";
        popup.className = "lucid-transparent-popup visible";
        popup.innerHTML = `
                <div class="lucid-flex lucid-flex-col" style="height: 100%;">
                    <div class="lucid-flex lucid-flex-between lucid-m-2">
                        <h2 class="lucid-text-xl lucid-font-semibold lucid-text-primary">单词详情</h2>
                        <button class="lucid-btn lucid-btn-sm" onclick="this.closest('.lucid-transparent-popup').remove()">✕</button>
                    </div>
                    <div class="lucid-flex lucid-flex-col lucid-flex-1 lucid-p-4">
                        <div class="lucid-text-2xl lucid-font-semibold lucid-text-primary lucid-m-2">beautiful</div>
                        <div class="lucid-text-secondary lucid-m-1">/'bjuːtɪf(ə)l/</div>
                        
                        <div class="lucid-flex lucid-flex-col lucid-m-4">
                            <div class="lucid-text-sm lucid-text-tertiary lucid-m-1">adjective</div>
                            <div class="lucid-text-primary lucid-m-1">美丽的，漂亮的</div>
                            <div class="lucid-text-secondary lucid-text-sm lucid-m-1">令人愉快的，优美的</div>
                        </div>
                        
                        <div class="lucid-flex lucid-flex-col lucid-m-4">
                            <div class="lucid-text-sm lucid-text-tertiary lucid-m-1">例句</div>
                            <div class="lucid-text-primary lucid-text-sm lucid-m-1">She has beautiful eyes.</div>
                            <div class="lucid-text-secondary lucid-text-sm">她有一双美丽的眼睛。</div>
                        </div>
                    </div>
                </div>
            `;

        popup.style.cssText = `
                position: fixed;
                top: 50px;
                right: 50px;
                z-index: 2147483648;
            `;

        document.body.appendChild(popup);
      };

      // 在指定位置显示透明弹窗
      window.showTransparentPopupAtPosition = function () {
        const popup = document.createElement("div");
        popup.className = "lucid-transparent-popup visible";
        popup.innerHTML = `
                <div class="lucid-text-center lucid-p-6">
                    <h3 class="lucid-text-lg lucid-font-semibold lucid-text-primary lucid-m-2">测试弹窗</h3>
                    <p class="lucid-text-secondary">这是一个测试透明弹窗</p>
                    <button class="lucid-btn lucid-btn-md lucid-m-2" onclick="this.closest('.lucid-transparent-popup').remove()">关闭</button>
                </div>
            `;

        popup.style.cssText = `
                position: fixed;
                top: 200px;
                left: 200px;
                z-index: 2147483648;
            `;

        document.body.appendChild(popup);

        // 5秒后自动移除
        setTimeout(() => {
          if (popup.parentNode) {
            popup.parentNode.removeChild(popup);
          }
        }, 5000);
      };

      // 页面加载完成后的提示
      console.log("Shadow DOM 测试页面加载完成");
      console.log("页面中已添加冲突样式，用于测试 Shadow DOM 隔离效果");
    </script>
  </body>
</html>
