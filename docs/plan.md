# Lucid 浏览器插件开发计划

**文档版本**: v2.0
**最后更新**: 2025-01-27 12:50:00 +08:00
**更新原因**: 基于项目实际开发进度全面更新开发计划，反映当前状态和未来规划

## 项目概述

Lucid 是一个智能浏览器扩展，专注于通过智能高亮和查词功能帮助用户理清知识要点。该扩展允许用户在任意网页上选择并高亮文本，并提供即时的词汇查询和学习功能。

### 核心价值主张

- **智能高亮**: 自动扩展选择到完整单词，支持多种高亮样式
- **即时查词**: 集成后端 API，提供权威词汇释义和发音
- **学习追踪**: 记录用户查词历史，支持生词本管理
- **跨平台**: 支持 Chrome、Firefox 等主流浏览器

---

## 当前项目状态总览

### ✅ 已完成功能模块

#### 基础架构 (100% 完成)

- ✅ **项目初始化**: WXT + React 19 + TypeScript
- ✅ **构建配置**: Vite 构建工具，支持 Chrome/Firefox
- ✅ **权限配置**: storage、tts、contextMenus 权限
- ✅ **开发环境**: 热重载、DevTools 自动打开

#### 核心高亮功能 (70% 完成)

- ✅ **文本选择**: 支持在任意网页上选择文本
- ✅ **智能扩展**: 自动扩展选择到完整单词边界
- ✅ **基础高亮**: 基础高亮功能实现
- ✅ **事件处理**: Shift 键触发、右键菜单支持
- ✅ **主题检测**: 自动检测网页主题（明暗模式）

#### 技术基础设施 (85% 完成)

- ✅ **Content Script**: 完整的内容脚本实现
- ✅ **Background Script**: 后台脚本和上下文菜单
- ✅ **Popup 框架**: 基础 React 组件结构
- ✅ **工具函数**: 选择处理和高亮工具函数
- ✅ **样式系统**: TailwindCSS 集成

### 🔄 进行中的功能

#### 高亮系统优化 (30% 完成)

- ⭕ **样式梯度**: 基于标记次数的颜色梯度变化
- ⭕ **持久化存储**: 高亮数据的本地存储
- ⭕ **高亮管理**: 添加/删除单个高亮功能

### ❌ 待开发功能模块

#### 查词功能 (0% 完成)

- ❌ **API 集成**: 与后端词典 API 的集成
- ❌ **查词界面**: Popup 中的查词结果展示
- ❌ **缓存机制**: 本地查词结果缓存
- ❌ **发音功能**: TTS 或音频播放支持

#### 用户界面 (15% 完成)

- ❌ **Popup 重设计**: 功能完整的弹出窗口
- ❌ **设置页面**: 用户偏好设置界面
- ❌ **高亮管理**: 高亮列表和搜索功能
- ❌ **统计面板**: 学习进度和统计信息

#### 数据管理 (0% 完成)

- ❌ **本地存储**: 用户设置和高亮数据
- ❌ **数据同步**: 多设备间的数据同步
- ❌ **导入导出**: 数据备份和恢复功能
- ❌ **生词本**: 个人生词本管理

#### 高级功能 (0% 完成)

- ❌ **快捷键**: 自定义键盘快捷键
- ❌ **网站适配**: 特定网站的兼容性优化
- ❌ **批量操作**: 批量高亮管理功能
- ❌ **学习模式**: 复习和测试功能

---

## 技术架构现状

### 已实现的架构组件

#### WXT 框架结构

```
entrypoints/
├── background.ts         # 后台脚本 ✅
├── content.ts           # 内容脚本 ✅
└── popup/               # 弹出窗口 ✅
    ├── index.html
    ├── main.tsx
    ├── App.tsx
    └── style.css
```

#### 工具函数模块

```
utils/
├── selectionUtils.ts    # 文本选择处理 ✅
└── highlightUtils.ts    # 高亮应用逻辑 ✅
```

#### 技术栈完整性

- **框架**: WXT (WebExtension Tools) ✅
- **前端**: React 19 + TypeScript ✅
- **构建**: Vite + PostCSS ✅
- **样式**: TailwindCSS ✅
- **工具**: lodash-es (debounce) ✅

### 待实现的架构组件

#### API 集成层

```
services/
├── dictionaryApi.ts     # 词典 API 客户端
├── cacheService.ts      # 本地缓存管理
└── syncService.ts       # 数据同步服务
```

#### 数据管理层

```
storage/
├── settingsStorage.ts   # 用户设置存储
├── highlightStorage.ts  # 高亮数据存储
└── wordStorage.ts       # 生词本存储
```

#### 组件系统

```
components/
├── WordLookup/          # 查词组件
├── HighlightManager/    # 高亮管理组件
├── Settings/            # 设置组件
└── Statistics/          # 统计组件
```

---

## 详细开发计划

### 第一优先级：完善高亮系统

#### 1.1 高亮样式梯度系统 (预计 2-3 天)

**目标**: 实现基于标记次数的颜色梯度变化

**任务清单**:

- [ ] 实现颜色梯度算法 ✅
- [ ] 集成主题检测（明暗模式） ✅
- [ ] 添加标记次数统计
- [ ] 测试不同网站的兼容性
- [ ] 优化性能和内存使用

**验收标准**:

- 高亮颜色根据标记次数自动调整
- 支持明暗主题自适应
- 颜色变化平滑自然

#### 1.2 高亮数据持久化 (预计 2-3 天)

**目标**: 实现高亮数据的本地存储和恢复

**任务清单**:

- [ ] 设计存储数据结构
- [ ] 实现 browser.storage.local API
- [ ] 添加数据序列化/反序列化
- [ ] 实现页面加载时高亮恢复
- [ ] 添加数据清理和优化

**验收标准**:

- 高亮在页面刷新后保持
- 存储空间使用合理
- 数据读写性能良好

#### 1.3 高亮管理功能 (预计 1-2 天)

**目标**: 提供高亮的添加、删除、编辑功能

**任务清单**:

- [ ] 实现单个高亮删除
- [ ] 添加批量删除功能
- [ ] 实现高亮编辑（颜色、备注）
- [ ] 添加高亮搜索功能

**验收标准**:

- 用户可以方便地管理高亮
- 操作响应迅速
- 界面直观易用

### 第二优先级：查词功能集成

#### 2.1 API 客户端开发 (预计 3-4 天)

**目标**: 集成后端词典 API，实现查词功能

**任务清单**:

- [ ] 创建 API 客户端服务
- [ ] 实现错误处理和重试机制
- [ ] 添加请求缓存策略
- [ ] 集成认证和权限管理
- [ ] 优化网络请求性能

**验收标准**:

- 查词请求成功率 > 95%
- 平均响应时间 < 2 秒
- 离线缓存正常工作

#### 2.2 查词界面开发 (预计 4-5 天)

**目标**: 在 Popup 中展示查词结果

**任务清单**:

- [ ] 设计查词结果展示组件
- [ ] 实现发音播放功能
- [ ] 添加释义详情展示
- [ ] 集成生词本添加功能
- [ ] 优化加载状态和错误处理

**验收标准**:

- 查词结果展示完整准确
- 发音功能正常工作
- 用户体验流畅

#### 2.3 本地缓存系统 (预计 2-3 天)

**目标**: 实现查词结果的本地缓存

**任务清单**:

- [ ] 设计缓存数据结构
- [ ] 实现 LRU 缓存策略
- [ ] 添加缓存过期机制
- [ ] 优化存储空间使用
- [ ] 实现缓存统计和清理

**验收标准**:

- 缓存命中率 > 80%
- 存储空间控制在合理范围
- 缓存更新策略有效

### 第三优先级：用户界面完善

#### 3.1 Popup 重新设计 (预计 5-6 天)

**目标**: 创建功能完整的扩展弹出窗口

**任务清单**:

- [ ] 设计新的 UI 布局
- [ ] 实现查词搜索界面
- [ ] 添加高亮管理面板
- [ ] 集成设置快捷入口
- [ ] 优化响应式设计

**验收标准**:

- 界面美观现代
- 功能布局合理
- 操作流程顺畅

#### 3.2 设置页面开发 (预计 3-4 天)

**目标**: 提供完整的用户设置界面

**任务清单**:

- [ ] 创建设置页面框架
- [ ] 实现主题和颜色设置
- [ ] 添加快捷键配置
- [ ] 集成数据管理功能
- [ ] 实现设置导入导出

**验收标准**:

- 设置项目完整
- 配置即时生效
- 数据备份恢复正常

#### 3.3 统计和分析功能 (预计 2-3 天)

**目标**: 提供学习进度和使用统计

**任务清单**:

- [ ] 实现使用数据收集
- [ ] 创建统计图表组件
- [ ] 添加学习进度跟踪
- [ ] 实现数据可视化
- [ ] 优化性能和隐私保护

**验收标准**:

- 统计数据准确
- 图表展示清晰
- 隐私保护到位

### 第四优先级：高级功能和优化

#### 4.1 多设备同步 (预计 4-5 天)

**目标**: 实现跨设备的数据同步

**任务清单**:

- [ ] 设计同步数据格式
- [ ] 实现云端存储集成
- [ ] 添加冲突解决机制
- [ ] 优化同步性能
- [ ] 实现离线支持

**验收标准**:

- 数据同步准确可靠
- 冲突处理合理
- 同步速度快

#### 4.2 网站兼容性优化 (预计 3-4 天)

**目标**: 提升在各种网站上的兼容性

**任务清单**:

- [ ] 测试主流网站兼容性
- [ ] 修复已知兼容性问题
- [ ] 添加网站特定适配
- [ ] 优化性能和稳定性
- [ ] 实现白名单/黑名单功能

**验收标准**:

- 主流网站正常工作
- 性能影响最小
- 稳定性良好

#### 4.3 测试和质量保证 (预计 3-4 天)

**目标**: 建立完整的测试体系

**任务清单**:

- [ ] 编写单元测试
- [ ] 实现集成测试
- [ ] 添加 E2E 测试
- [ ] 建立 CI/CD 流程
- [ ] 优化代码质量

**验收标准**:

- 测试覆盖率 > 80%
- 自动化测试通过
- 代码质量达标

---

## 里程碑和时间规划

### 近期里程碑 (接下来 2 周)

#### 里程碑 1: 高亮系统完善 (2025-02-10)

- ✅ 颜色梯度系统完成
- ✅ 高亮数据持久化
- ✅ 基础高亮管理功能
- ✅ 主题适配优化

#### 里程碑 2: 查词功能集成 (2025-02-24)

- ✅ API 客户端完成
- ✅ 查词界面实现
- ✅ 本地缓存系统
- ✅ 基础发音功能

### 中期里程碑 (接下来 1-2 月)

#### 里程碑 3: 用户界面完善 (2025-03-15)

- ✅ Popup 重新设计完成
- ✅ 设置页面实现
- ✅ 统计功能上线
- ✅ 用户体验优化

#### 里程碑 4: 高级功能 (2025-03-31)

- ✅ 多设备同步功能
- ✅ 网站兼容性优化
- ✅ 完整测试覆盖
- ✅ 性能优化完成

### 长期规划 (3-6 月)

#### 里程碑 5: 发布准备 (2025-06-30)

- ✅ 商店发布准备
- ✅ 用户文档完善
- ✅ 多语言支持
- ✅ 企业版功能

---

## 风险评估和缓解策略

### 技术风险

#### 高风险

1. **浏览器兼容性问题**

   - **风险**: 不同浏览器 API 差异导致功能异常
   - **缓解**: 使用 WXT 框架统一 API，充分测试

2. **网站兼容性问题**
   - **风险**: 某些网站的 CSP 或特殊结构影响功能
   - **缓解**: 建立兼容性测试套件，逐步优化

#### 中风险

3. **性能影响**

   - **风险**: 扩展影响网页加载和运行性能
   - **缓解**: 优化代码，使用防抖和节流，异步处理

4. **数据存储限制**
   - **风险**: 浏览器存储空间限制影响功能
   - **缓解**: 优化数据结构，实现数据清理机制

### 项目风险

#### 中风险

1. **API 依赖**

   - **风险**: 后端 API 不稳定影响查词功能
   - **缓解**: 实现离线缓存，多 API 源支持

2. **用户体验复杂性**
   - **风险**: 功能过多导致用户界面复杂
   - **缓解**: 渐进式功能展示，优化交互设计

---

## 资源需求和团队协作

### 开发资源

- **主要开发者**: 1 人（前端开发）
- **预计工作量**: 每周 15-25 小时
- **关键技能**: React、TypeScript、浏览器扩展开发

### 外部依赖

- **后端 API**: 依赖 lucid-bd 项目提供的词典 API
- **设计资源**: UI/UX 设计支持
- **测试设备**: 多浏览器测试环境

### 协作工具

- **代码管理**: Git + GitHub
- **项目管理**: 基于里程碑的敏捷开发
- **测试工具**: 浏览器开发者工具 + 自动化测试

---

## 质量保证策略

### 代码质量

- **静态分析**: ESLint + TypeScript 严格模式
- **代码格式**: Prettier 自动格式化
- **组件测试**: React Testing Library

### 功能测试

- **手动测试**: 多浏览器兼容性测试
- **自动化测试**: E2E 测试覆盖核心流程
- **性能测试**: 内存使用和响应时间监控

### 用户体验

- **可用性测试**: 用户操作流程验证
- **无障碍测试**: 键盘导航和屏幕阅读器支持
- **响应式测试**: 不同屏幕尺寸适配

---

## 成功指标

### 技术指标

- ✅ 扩展加载时间 < 100ms
- ✅ 高亮应用响应时间 < 50ms
- ✅ 查词请求成功率 > 95%
- ✅ 内存使用 < 50MB

### 功能指标

- ✅ 高亮功能在主流网站正常工作
- ✅ 查词结果准确率 > 90%
- ✅ 数据同步成功率 > 98%
- ✅ 用户设置保存可靠

### 用户体验指标

- ✅ 操作流程直观易懂
- ✅ 界面响应迅速
- ✅ 错误处理友好
- ✅ 学习曲线平缓

---

## 与后端项目的集成

### API 接口依赖

- **查词接口**: `GET /api/dictionary/[lang]/[word]`
- **用户认证**: 未来可能需要用户登录功能
- **数据同步**: 云端存储和同步服务

### 数据格式协议

- **查词请求**: 标准化的查词参数格式
- **响应数据**: 统一的词汇数据结构
- **错误处理**: 一致的错误码和消息格式

### 开发协调

- **API 变更通知**: 及时同步接口变更
- **测试环境**: 共享开发和测试环境
- **版本兼容**: 保持前后端版本兼容性

---

## 更新记录

### v2.0 (2025-01-27)

- 基于实际开发进度全面更新计划
- 重新评估已完成和待完成功能
- 调整里程碑和时间规划
- 完善风险评估和缓解策略
- 明确与后端项目的集成方案

### v1.0 (2025-01-20)

- 初始开发计划
- 基础功能规划
- 技术架构设计
