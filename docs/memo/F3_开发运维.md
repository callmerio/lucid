# F3_å¼€å‘è¿ç»´.md - Lucid æµè§ˆå™¨æ‰©å±•

## ğŸ”§ ç¯å¢ƒè®¾ç½®

### å¼€å‘ç¯å¢ƒè¦æ±‚
```bash
# åŸºç¡€ç¯å¢ƒ
Node.js >= 18.0.0
pnpm >= 8.0.0
Git >= 2.30.0

# æ¨èIDE
VS Code + æ‰©å±•åŒ…:
â”œâ”€â”€ TypeScript and JavaScript Language Features
â”œâ”€â”€ ES7+ React/Redux/React-Native snippets
â”œâ”€â”€ Tailwind CSS IntelliSense
â”œâ”€â”€ ESLint
â”œâ”€â”€ Prettier
â””â”€â”€ WXT Extension Development
```

### å¿«é€Ÿå¯åŠ¨
```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd lucid

# å®‰è£…ä¾èµ–
pnpm install

# å¼€å‘æ¨¡å¼ (Chrome)
pnpm dev

# å¼€å‘æ¨¡å¼ (Firefox)
pnpm dev:firefox

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build

# è¿è¡Œæµ‹è¯•
pnpm test
```

### ç¯å¢ƒé…ç½®æ–‡ä»¶
```
.env.development     # å¼€å‘ç¯å¢ƒé…ç½®
.env.production      # ç”Ÿäº§ç¯å¢ƒé…ç½®
.env.local          # æœ¬åœ°è¦†ç›–é…ç½® (git ignored)

# ç¤ºä¾‹é…ç½®
API_ENDPOINT=https://api.lucid.dev
CACHE_EXPIRY=3600000
DEBUG_MODE=true
```

## ğŸ“‚ é¡¹ç›®ç»“æ„

### ç›®å½•ç»„ç»‡
```
lucid/
â”œâ”€â”€ docs/                    # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ riper/              # RIPERç³»ç»Ÿæ–‡æ¡£
â”‚   â”œâ”€â”€ architecture/       # æ¶æ„è®¾è®¡æ–‡æ¡£
â”‚   â””â”€â”€ api/                # APIæ–‡æ¡£
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ components/         # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ features/       # åŠŸèƒ½ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/            # åŸºç¡€UIç»„ä»¶
â”‚   â”‚   â””â”€â”€ layout/        # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ api/           # APIå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ storage/       # å­˜å‚¨æœåŠ¡
â”‚   â”‚   â””â”€â”€ cache/         # ç¼“å­˜æœåŠ¡
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ dom/           # DOMæ“ä½œ
â”‚   â”‚   â”œâ”€â”€ text/          # æ–‡æœ¬å¤„ç†
â”‚   â”‚   â””â”€â”€ highlight/     # é«˜äº®é€»è¾‘
â”‚   â”œâ”€â”€ types/             # TypeScriptç±»å‹
â”‚   â”œâ”€â”€ styles/            # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ tests/             # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ entrypoints/           # WXTå…¥å£ç‚¹
â”‚   â”œâ”€â”€ background.ts      # åå°è„šæœ¬
â”‚   â”œâ”€â”€ content.ts         # å†…å®¹è„šæœ¬
â”‚   â””â”€â”€ popup/             # å¼¹çª—ç•Œé¢
â”œâ”€â”€ assets/                # é™æ€èµ„æº
â”œâ”€â”€ utils/                 # å…¨å±€å·¥å…·å‡½æ•°
â””â”€â”€ public/                # å…¬å…±èµ„æº
```

### ä»£ç ç»„ç»‡åŸåˆ™
- **åŠŸèƒ½ä¼˜å…ˆ**: æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ä»£ç 
- **å±‚æ¬¡åˆ†ç¦»**: æ¸…æ™°çš„æ¶æ„å±‚æ¬¡
- **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—èŒè´£æ˜ç¡®
- **ä¾èµ–ç®¡ç†**: åˆç†çš„ä¾èµ–å…³ç³»

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•æ¡†æ¶é…ç½®
```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    environment: 'jsdom',
    setupFiles: ['./src/tests/setup.ts'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'html', 'lcov'],
      threshold: {
        global: {
          branches: 80,
          functions: 80,
          lines: 80,
          statements: 80
        }
      }
    }
  }
});
```

### æµ‹è¯•åˆ†å±‚ç­–ç•¥

#### å•å…ƒæµ‹è¯• (Unit Tests)
```bash
# å·¥å…·å‡½æ•°æµ‹è¯•
src/utils/**/*.test.ts

# ç»„ä»¶æµ‹è¯•
src/components/**/*.test.tsx

# æœåŠ¡æµ‹è¯•
src/services/**/*.test.ts

# è¿è¡Œå•å…ƒæµ‹è¯•
pnpm test:unit
```

#### é›†æˆæµ‹è¯• (Integration Tests)
```bash
# APIé›†æˆæµ‹è¯•
src/tests/integration/api.test.ts

# å­˜å‚¨é›†æˆæµ‹è¯•
src/tests/integration/storage.test.ts

# è¿è¡Œé›†æˆæµ‹è¯•
pnpm test:integration
```

#### E2Eæµ‹è¯• (End-to-End Tests)
```bash
# ä½¿ç”¨Playwrightè¿›è¡ŒE2Eæµ‹è¯•
tests/e2e/highlight.spec.ts
tests/e2e/lookup.spec.ts

# è¿è¡ŒE2Eæµ‹è¯•
pnpm test:e2e
```

### æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡
- **ä»£ç è¦†ç›–ç‡**: > 80%
- **åˆ†æ”¯è¦†ç›–ç‡**: > 75%
- **å‡½æ•°è¦†ç›–ç‡**: > 85%
- **å…³é”®è·¯å¾„**: 100%

## ğŸš€ éƒ¨ç½²æµç¨‹

### æ„å»ºæµç¨‹
```bash
# 1. ä»£ç è´¨é‡æ£€æŸ¥
pnpm lint
pnpm type-check
pnpm test:run

# 2. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build

# 3. ç”Ÿæˆå‘å¸ƒåŒ…
pnpm zip

# 4. ç‰ˆæœ¬æ ‡è®°
git tag v1.0.0
git push origin v1.0.0
```

### å‘å¸ƒæ¸ é“

#### Chrome Web Store
```bash
# æ„å»ºChromeç‰ˆæœ¬
pnpm build

# ä¸Šä¼ åˆ°Chrome Web Store
# ä½¿ç”¨Chrome Developer Dashboard
```

#### Firefox Add-ons
```bash
# æ„å»ºFirefoxç‰ˆæœ¬
pnpm build:firefox

# ä¸Šä¼ åˆ°Firefox Add-ons
# ä½¿ç”¨Firefox Developer Hub
```

#### å†…éƒ¨åˆ†å‘
```bash
# ç”Ÿæˆå¼€å‘è€…ç‰ˆæœ¬
pnpm build --mode development

# æ‰“åŒ…åˆ†å‘æ–‡ä»¶
pnpm zip:dev
```

### CI/CD æµç¨‹
```yaml
# .github/workflows/ci.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: pnpm install
      - run: pnpm lint
      - run: pnpm test:run
      - run: pnpm build

  release:
    needs: test
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - run: pnpm zip
      - uses: actions/upload-artifact@v3
        with:
          name: extension-build
          path: .output/*.zip
```

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### å¼€å‘è°ƒè¯•
```javascript
// å¼€å‘ç¯å¢ƒè°ƒè¯•é…ç½®
if (import.meta.env.DEV) {
  // å¯ç”¨è¯¦ç»†æ—¥å¿—
  console.debug('Lucid Extension: Debug mode enabled');
  
  // æ€§èƒ½ç›‘æ§
  performance.mark('extension-start');
  
  // é”™è¯¯è¿½è¸ª
  window.addEventListener('error', (e) => {
    console.error('Extension Error:', e);
  });
}
```

### ç”Ÿäº§ç›‘æ§
```typescript
// é”™è¯¯æŠ¥å‘ŠæœåŠ¡
class ErrorReporter {
  static report(error: Error, context: string) {
    // å‘é€é”™è¯¯æŠ¥å‘Šåˆ°ç›‘æ§æœåŠ¡
    if (import.meta.env.PROD) {
      // å®é™…çš„é”™è¯¯æŠ¥å‘Šé€»è¾‘
    }
  }
}

// æ€§èƒ½ç›‘æ§
class PerformanceMonitor {
  static trackTiming(name: string, duration: number) {
    // è®°å½•æ€§èƒ½æŒ‡æ ‡
  }
  
  static trackMemory() {
    // ç›‘æ§å†…å­˜ä½¿ç”¨
  }
}
```

### æ—¥å¿—ç®¡ç†
```typescript
// ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ
class Logger {
  static debug(message: string, data?: any) {
    if (import.meta.env.DEV) {
      console.debug(`[Lucid] ${message}`, data);
    }
  }
  
  static info(message: string, data?: any) {
    console.info(`[Lucid] ${message}`, data);
  }
  
  static error(message: string, error?: Error) {
    console.error(`[Lucid] ${message}`, error);
    ErrorReporter.report(error, message);
  }
}
```

## ğŸ”§ å¼€å‘å·¥å…·é…ç½®

### VS Code é…ç½®
```json
// .vscode/settings.json
{
  "typescript.preferences.importModuleSpecifier": "relative",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "tailwindCSS.experimental.classRegex": [
    ["clsx\\(([^)]*)\\)", "(?:'|\"|`)([^']*)(?:'|\"|`)"]
  ]
}
```

### Git Hooks
```bash
# .husky/pre-commit
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

pnpm lint-staged
pnpm type-check

# .husky/commit-msg
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

pnpm commitlint --edit $1
```

### ä»£ç è´¨é‡å·¥å…·
```json
// package.json scripts
{
  "lint": "eslint . --ext .ts,.tsx,.js,.jsx",
  "lint:fix": "eslint . --ext .ts,.tsx,.js,.jsx --fix",
  "format": "prettier --write .",
  "format:check": "prettier --check .",
  "type-check": "tsc --noEmit"
}
```
