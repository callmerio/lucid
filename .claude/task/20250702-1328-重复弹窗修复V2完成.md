# 20250702-1328 é‡å¤ Tooltip Detail å¼¹çª—ä¿®å¤ V2 å®Œæˆ

## é—®é¢˜è¯Šæ–­

ç»è¿‡åˆ†æç”¨æˆ·æä¾›çš„è¯¦ç»†æ—¥å¿—ï¼Œå‘ç°é—®é¢˜çš„æ ¹æœ¬åŸå› åœ¨äº `TooltipManager.showDetailedView()` æ–¹æ³•ä¸­çš„çŠ¶æ€æ£€æŸ¥é€»è¾‘æ—¶æœºé”™è¯¯ï¼š

1. **çŠ¶æ€æ›´æ–°æ—¶æœºé—®é¢˜**: å½“ä»ä¸€ä¸ªå•è¯åˆ‡æ¢åˆ°å¦ä¸€ä¸ªå•è¯æ—¶ï¼Œ`stateManager.getCurrentWord()` åœ¨äº‹ä»¶è§¦å‘æ—¶å·²ç»è¢«æ–°çš„ `hover-enter` äº‹ä»¶æ›´æ–°
2. **æ£€æŸ¥é€»è¾‘å¤±æ•ˆ**: åŸºäºå·²æ›´æ–°çŠ¶æ€çš„æ£€æŸ¥æ— æ³•æ­£ç¡®è¯†åˆ«éœ€è¦å…³é—­çš„æ—§è¯¦ç»†å¼¹çª—
3. **ç»“æœ**: æ—§çš„è¯¦ç»†å¼¹çª—æ²¡æœ‰è¢«å…³é—­ï¼Œå¯¼è‡´å¤šä¸ªè¯¦ç»†å¼¹çª—åŒæ—¶å­˜åœ¨

## ä¿®å¤ç­–ç•¥

### 1. æ·»åŠ ä¸“ç”¨è¯¦ç»†æ¨¡å¼çŠ¶æ€è·Ÿè¸ª

åœ¨ `TooltipManager` ä¸­æ·»åŠ  `currentDetailedWord` å±æ€§ï¼š

```typescript
private currentDetailedWord: string = ""; // è·Ÿè¸ªå½“å‰è¯¦ç»†æ¨¡å¼çš„å•è¯
```

### 2. ä¿®å¤æ£€æŸ¥é€»è¾‘æ—¶æœº

åœ¨ `showDetailedView` æ–¹æ³•ä¸­ï¼Œåœ¨çŠ¶æ€æ›´æ–°å‰è·å–å¹¶ä¿å­˜æ—§çŠ¶æ€ï¼š

```typescript
// åœ¨çŠ¶æ€æ›´æ–°å‰è·å–å½“å‰å•è¯çŠ¶æ€ï¼Œé¿å…çŠ¶æ€æ›´æ–°å¯¼è‡´æ£€æŸ¥å¤±æ•ˆ
const previousWord = this.currentDetailedWord; // ä½¿ç”¨ä¸“ç”¨çš„è¯¦ç»†æ¨¡å¼å•è¯è·Ÿè¸ª
const wasInDetailedMode = this.currentMode === "detailed";

// å¦‚æœå·²ç»æ˜¯è¯¦ç»†æ¨¡å¼ä¸”åˆ‡æ¢åˆ°ä¸åŒå•è¯ï¼Œå…ˆå…³é—­æ—§çš„è¯¦ç»†å¼¹çª—
if (wasInDetailedMode && previousWord && previousWord !== word) {
  console.log(`[TooltipManager] Switching from "${previousWord}" to "${word}" detailed view - closing old popup`);
  popupService.hide(`toolfull-detailed-${previousWord}`);
}
```

### 3. çŠ¶æ€ç®¡ç†æ”¹è¿›

- **ä¸“ç”¨çŠ¶æ€è·Ÿè¸ª**: ä½¿ç”¨ `currentDetailedWord` ç‹¬ç«‹è·Ÿè¸ªè¯¦ç»†æ¨¡å¼çŠ¶æ€
- **çŠ¶æ€æ›´æ–°æ—¶æœº**: åœ¨æ£€æŸ¥é€»è¾‘å®Œæˆåå†æ›´æ–°çŠ¶æ€
- **çŠ¶æ€æ¸…ç†**: åœ¨éšè—å’Œæœ€å°åŒ–æ“ä½œä¸­æ­£ç¡®æ¸…ç†è¯¦ç»†æ¨¡å¼çŠ¶æ€

### 4. å¢å¼ºæ—¥å¿—è°ƒè¯•

æ·»åŠ è¯¦ç»†çš„çŠ¶æ€è·Ÿè¸ªæ—¥å¿—ï¼š

```typescript
console.log(`[TooltipManager] showDetailedView called:`, {
  requestedWord: word,
  currentDetailedWord: previousWord,
  stateManagerWord: this.stateManager.getCurrentWord(),
  wasInDetailedMode,
  currentMode: this.currentMode
});
```

## æ–‡ä»¶ä¿®æ”¹

### src/utils/dom/managers/tooltip/TooltipManager.tsx

1. **æ·»åŠ çŠ¶æ€è·Ÿè¸ªå±æ€§**:
   ```typescript
   private currentDetailedWord: string = ""; // è·Ÿè¸ªå½“å‰è¯¦ç»†æ¨¡å¼çš„å•è¯
   ```

2. **ä¿®å¤æ£€æŸ¥é€»è¾‘**:
   - ä½¿ç”¨ä¸“ç”¨çŠ¶æ€è€Œé StateManager çš„åŠ¨æ€çŠ¶æ€
   - åœ¨çŠ¶æ€æ›´æ–°å‰æ‰§è¡Œæ£€æŸ¥å’Œæ¸…ç†

3. **çŠ¶æ€æ¸…ç†**:
   - åœ¨ `hideTooltip()` ä¸­æ¸…ç†è¯¦ç»†æ¨¡å¼çŠ¶æ€
   - åœ¨ `handleMinimize()` ä¸­æ¸…ç†è¯¦ç»†æ¨¡å¼çŠ¶æ€

4. **å¢å¼ºé”™è¯¯å¤„ç†**:
   - æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
   - å¤±è´¥æ—¶æ­£ç¡®é‡ç½®çŠ¶æ€

## ä»£ç è´¨é‡ä¼˜åŒ–

- ä¿®å¤äº†é‡å¤çš„ import è¯­å¥
- ç§»é™¤äº†æœªä½¿ç”¨çš„å˜é‡
- æ¸…ç†äº†é‡å¤çš„ catch å—

## é¢„æœŸæ•ˆæœ

ä¿®å¤åçš„è¡Œä¸ºï¼š

1. **å•ä¸€è¯¦ç»†å¼¹çª—**: åŒæ—¶åªæ˜¾ç¤ºä¸€ä¸ªè¯¦ç»†å¼¹çª—
2. **æ­£ç¡®åˆ‡æ¢**: ä»ä¸€ä¸ªå•è¯åˆ‡æ¢åˆ°å¦ä¸€ä¸ªå•è¯æ—¶ï¼Œæ—§å¼¹çª—è‡ªåŠ¨å…³é—­
3. **çŠ¶æ€ä¸€è‡´**: è¯¦ç»†æ¨¡å¼çŠ¶æ€è·Ÿè¸ªå‡†ç¡®å¯é 
4. **å¢å¼ºè°ƒè¯•**: è¯¦ç»†çš„æ—¥å¿—å¸®åŠ©é—®é¢˜å®šä½

## æµ‹è¯•çŠ¶æ€

- âœ… ä»£ç ä¿®å¤å®Œæˆ
- âœ… TypeScript ç¼–è¯‘é€šè¿‡
- âœ… æ„å»ºæˆåŠŸ
- ğŸŸ¡ éœ€è¦åœ¨æµè§ˆå™¨ä¸­å®é™…æµ‹è¯•ç”¨æˆ·æŠ¥å‘Šçš„åœºæ™¯

## å…³é”®æ”¹è¿›

æ­¤æ¬¡ä¿®å¤è§£å†³äº†çŠ¶æ€ç®¡ç†çš„æ ¹æœ¬é—®é¢˜ï¼Œé€šè¿‡ä¸“ç”¨çš„è¯¦ç»†æ¨¡å¼çŠ¶æ€è·Ÿè¸ªå’Œæ­£ç¡®çš„æ£€æŸ¥æ—¶æœºï¼Œç¡®ä¿äº†tooltip detailå¼¹çª—çš„æ­£ç¡®è¡Œä¸ºï¼Œæå‡äº†ç”¨æˆ·ä½“éªŒçš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚