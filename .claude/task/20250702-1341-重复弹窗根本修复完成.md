# 20250702-1341 é‡å¤ Tooltip Detail å¼¹çª—æ ¹æœ¬ä¿®å¤å®Œæˆ

## ğŸ” æ·±åº¦é—®é¢˜åˆ†æ

é€šè¿‡ç³»ç»Ÿæ€§çš„æ·±åº¦åˆ†æï¼Œå‘ç°äº†é‡å¤å¼¹çª—é—®é¢˜çš„**çœŸæ­£æ ¹æœ¬åŸå› **ï¼š

### é—®é¢˜æ—¥å¿—åˆ†æ
```
showDetailedView called: {
  requestedWord: 'chrome', 
  currentDetailedWord: 'favorite', 
  stateManagerWord: 'chrome', 
  wasInDetailedMode: false,  // âŒ å…³é”®é—®é¢˜ï¼šå§‹ç»ˆä¸º false
  currentMode: 'simple'      // âŒ æ¨¡å¼è¢«æ„å¤–é‡ç½®
}
```

### æ ¹æœ¬åŸå› å‘ç°

**äº‹ä»¶æ—¶åºé—®é¢˜**ï¼š
1. ç”¨æˆ·æ‚¬åœåˆ°æ–°å•è¯ â†’ è§¦å‘ `lucid:highlight:hover-enter` äº‹ä»¶
2. `HighlightTooltipBridge.handleHighlightHoverEnter()` è°ƒç”¨ `tooltipManager.showTooltip()`
3. **å…³é”®é—®é¢˜**ï¼š`showTooltip()` æ–¹æ³•å¼ºåˆ¶è®¾ç½® `this.currentMode = "simple"`
4. ç”¨æˆ·æŒ‰ Shift é”® â†’ `showDetailedView()` æ£€æŸ¥ `wasInDetailedMode` ä¸º `false`
5. æ¸…ç†é€»è¾‘æ°¸è¿œä¸ä¼šæ‰§è¡Œ â†’ æ—§å¼¹çª—ä¿ç•™ â†’ é‡å¤å¼¹çª—

## âš¡ æ ¹æœ¬ä¿®å¤æ–¹æ¡ˆ

### æ ¸å¿ƒä¿®å¤é€»è¾‘

åœ¨ `TooltipManager.showTooltip()` æ–¹æ³•ä¸­æ·»åŠ è¯¦ç»†æ¨¡å¼ä¿æŠ¤ï¼š

```typescript
async showTooltip(options: ShowTooltipOptions): Promise<void> {
  try {
    // ğŸ›¡ï¸ è¯¦ç»†æ¨¡å¼ä¿æŠ¤ï¼šé¿å…çŠ¶æ€é‡ç½®
    if (this.currentMode === "detailed") {
      console.log(`[TooltipManager] In detailed mode, updating state for word: "${word}" without mode reset`);
      // åªæ›´æ–°çŠ¶æ€ç®¡ç†å™¨ï¼Œä¸é‡ç½®æ¨¡å¼ï¼Œä¹Ÿä¸åˆ›å»ºç®€å•tooltip
      this.stateManager.show(word, targetElement);
      return;
    }

    // æ­£å¸¸çš„ç®€å•æ¨¡å¼é€»è¾‘
    this.stateManager.show(word, targetElement);
    this.currentMode = "simple";
    console.log(`[TooltipManager] Switched to simple mode for word: "${word}"`);
    
    // ... å…¶ä½™ç®€å•tooltipåˆ›å»ºé€»è¾‘
  }
}
```

### ä¿®å¤åŸç†

1. **çŠ¶æ€ä¿æŠ¤**ï¼šåœ¨è¯¦ç»†æ¨¡å¼æ—¶ï¼Œhover äº‹ä»¶ä¸ä¼šé‡ç½® `currentMode`
2. **é€»è¾‘ä¸€è‡´æ€§**ï¼š`wasInDetailedMode` æ£€æŸ¥ç°åœ¨èƒ½æ­£ç¡®è¿”å› `true`  
3. **æ¸…ç†æ‰§è¡Œ**ï¼šæ—§å¼¹çª—æ¸…ç†é€»è¾‘èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œ
4. **ç”¨æˆ·ä½“éªŒ**ï¼šè¯¦ç»†æ¨¡å¼ä¸‹æ‚¬åœåˆ°æ–°å•è¯åªæ›´æ–°ä¸Šä¸‹æ–‡ï¼Œä¸é€€å›ç®€å•æ¨¡å¼

## ğŸ“‹ ä¿®å¤éªŒè¯

### é¢„æœŸæ—¥å¿—å˜åŒ–

**ä¿®å¤å‰**ï¼š
```
wasInDetailedMode: false  // âŒ æ€»æ˜¯ false
currentMode: 'simple'     // âŒ è¢«æ„å¤–é‡ç½®
```

**ä¿®å¤å**ï¼š
```
wasInDetailedMode: true   // âœ… æ­£ç¡®è¯†åˆ«è¯¦ç»†æ¨¡å¼
currentMode: 'detailed'   // âœ… çŠ¶æ€ä¿æŒä¸€è‡´
Switching from "word1" to "word2" detailed view - closing old popup  // âœ… æ¸…ç†é€»è¾‘æ‰§è¡Œ
```

### è¡Œä¸ºæ”¹è¿›

- âœ… è¯¦ç»†æ¨¡å¼çŠ¶æ€æŒä¹…æ€§
- âœ… æ­£ç¡®çš„æ—§å¼¹çª—æ¸…ç†
- âœ… å•ä¸€è¯¦ç»†å¼¹çª—æ˜¾ç¤º
- âœ… å¢å¼ºçš„è°ƒè¯•æ—¥å¿—

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ–‡ä»¶ä¿®æ”¹

**`src/utils/dom/managers/tooltip/TooltipManager.tsx`**
- åœ¨ `showTooltip()` æ–¹æ³•å¼€å¤´æ·»åŠ è¯¦ç»†æ¨¡å¼æ£€æŸ¥
- é¿å…ä¸å¿…è¦çš„çŠ¶æ€é‡ç½®å’Œç®€å•tooltipåˆ›å»º
- ä¿æŒè¯¦ç»†æ¨¡å¼çš„ä¸Šä¸‹æ–‡ä¸€è‡´æ€§

### æ¶æ„ä¼˜åŠ¿

è¿™ä¸ªä¿®å¤æ–¹æ¡ˆï¼š
1. **æœ€å°ä¾µå…¥æ€§**ï¼šåªä¿®æ”¹ä¸€ä¸ªå…³é”®æ–¹æ³•
2. **é€»è¾‘æ¸…æ™°**ï¼šè¯¦ç»†æ¨¡å¼ä¸‹çš„è¡Œä¸ºæ›´ç¬¦åˆç”¨æˆ·é¢„æœŸ  
3. **å‘åå…¼å®¹**ï¼šä¸å½±å“ç°æœ‰çš„ç®€å•æ¨¡å¼åŠŸèƒ½
4. **æ˜“äºè°ƒè¯•**ï¼šå¢å¼ºçš„æ—¥å¿—ç³»ç»Ÿ

## ğŸ“Š æµ‹è¯•çŠ¶æ€

- âœ… TypeScript ç¼–è¯‘æˆåŠŸ
- âœ… æ„å»ºæµ‹è¯•é€šè¿‡
- âœ… ä»£ç é€»è¾‘éªŒè¯å®Œæˆ
- ğŸŸ¡ ç­‰å¾…æµè§ˆå™¨å®é™…æµ‹è¯•éªŒè¯

## ğŸ¯ é¢„æœŸæ•ˆæœ

ä¿®å¤åç”¨æˆ·æ“ä½œæµç¨‹ï¼š
1. æ‚¬åœé«˜äº®å•è¯ â†’ æ˜¾ç¤ºç®€å•tooltip
2. æŒ‰ Shift â†’ åˆ‡æ¢åˆ°è¯¦ç»†æ¨¡å¼ 
3. æ‚¬åœå¦ä¸€ä¸ªé«˜äº®å•è¯ â†’ **ä¿æŒè¯¦ç»†æ¨¡å¼**ï¼Œæ›´æ–°ä¸Šä¸‹æ–‡
4. æŒ‰ Shift â†’ **æ­£ç¡®æ¸…ç†æ—§å¼¹çª—**ï¼Œæ˜¾ç¤ºæ–°å•è¯è¯¦ç»†ä¿¡æ¯
5. ç»“æœï¼šåªæ˜¾ç¤ºå½“å‰æ¿€æ´»å•è¯çš„è¯¦ç»†å¼¹çª—

è¿™ä¸ªä¿®å¤è§£å†³äº†é‡å¤å¼¹çª—é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œæä¾›äº†æ›´ä¸€è‡´å’Œå¯é çš„ç”¨æˆ·ä½“éªŒã€‚