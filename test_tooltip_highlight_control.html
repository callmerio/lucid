<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tooltip é«˜äº®çŠ¶æ€æ§åˆ¶åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        .instructions {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #3498db;
        }

        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }

        .test-text {
            font-size: 16px;
            line-height: 1.8;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 6px;
        }

        .highlight-info {
            background: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 14px;
            border-left: 3px solid #ffc107;
        }

        .step-indicator {
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 8px;
        }

        .test-word {
            background: #e7f3ff;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
            color: #0066cc;
        }

        kbd {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 3px;
            padding: 2px 6px;
            font-family: monospace;
            font-size: 12px;
        }

        .expected-result {
            background: #d4edda;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border-left: 3px solid #28a745;
        }

        .debug-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border: 1px solid #dee2e6;
        }

        .debug-info h4 {
            color: #495057;
            margin-top: 0;
        }

        .debug-info ul {
            margin: 10px 0;
        }

        .debug-info li {
            margin: 5px 0;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        #debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-content">
        <h1>ğŸ¯ Tooltip é«˜äº®çŠ¶æ€æ§åˆ¶åŠŸèƒ½æµ‹è¯•</h1>

        <div class="instructions">
            <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
            <p>æœ¬æµ‹è¯•éªŒè¯ tooltip ç»„ä»¶ä¸­çˆ±å¿ƒå’Œä¸‹é™æŒ‰é’®çš„é«˜äº®çŠ¶æ€æ§åˆ¶åŠŸèƒ½ã€‚</p>

            <h4>ğŸ¯ æµ‹è¯•æ­¥éª¤ï¼š</h4>
            <ol>
                <li><span class="step-indicator">æ­¥éª¤1</span>é€‰æ‹©ä¸‹é¢ä»»æ„ä¸€ä¸ª <span class="test-word">"JavaScript"</span> è¯æ±‡</li>
                <li><span class="step-indicator">æ­¥éª¤2</span>æŒ‰ <kbd>Shift</kbd> é”®è¿›è¡Œé«˜äº®</li>
                <li><span class="step-indicator">æ­¥éª¤3</span>é¼ æ ‡æ‚¬åœåœ¨é«˜äº®çš„ <span class="test-word">"JavaScript"</span> ä¸ŠæŸ¥çœ‹ tooltip</li>
                <li><span class="step-indicator">æ­¥éª¤4</span>è§‚å¯ŸæŒ‰é’®é¢œè‰²ï¼šä¸‹æ‹‰ç®­å¤´åº”è¯¥ä¸é«˜äº®é¢œè‰²ä¸€è‡´ï¼Œçˆ±å¿ƒåº”è¯¥æ˜¯çº¢è‰²</li>
                <li><span class="step-indicator">æ­¥éª¤5</span>ç‚¹å‡»ä¸‹æ‹‰ç®­å¤´æŒ‰é’®ï¼Œè§‚å¯Ÿé«˜äº®è®¡æ•°å‡å°‘ï¼Œtooltipä¿æŒæ˜¾ç¤ºå¹¶æ›´æ–°æŒ‰é’®é¢œè‰²</li>
                <li><span class="step-indicator">æ­¥éª¤6</span>å¯ä»¥è¿ç»­ç‚¹å‡»ä¸‹æ‹‰ç®­å¤´å¤šæ¬¡å‡å°‘è®¡æ•°</li>
                <li><span class="step-indicator">æ­¥éª¤7</span>ç‚¹å‡»çˆ±å¿ƒæŒ‰é’®ï¼Œè§‚å¯Ÿæ‰€æœ‰é«˜äº®è¢«ç§»é™¤ï¼Œtooltipä¿æŒæ˜¾ç¤ºä½†æŒ‰é’®å˜ä¸ºç°è‰²</li>
                <li><span class="step-indicator">æ­¥éª¤8</span>ğŸ†• åœ¨æ— é«˜äº®çŠ¶æ€ä¸‹ï¼Œå†æ¬¡ç‚¹å‡»çˆ±å¿ƒæŒ‰é’®ï¼Œè§‚å¯Ÿé‡æ–°æ·»åŠ é«˜äº®ï¼ˆè®¡æ•°ä¸º1ï¼‰</li>
            </ol>

            <div class="expected-result">
                <strong>é¢„æœŸç»“æœï¼š</strong>
                <ul>
                    <li>Tooltip æŒ‰é’®é¢œè‰²åº”è¯¥åæ˜ å½“å‰é«˜äº®çŠ¶æ€</li>
                    <li>ä¸‹æ‹‰ç®­å¤´æŒ‰é’®é¢œè‰²ä¸é«˜äº®é¢œè‰²æ·±åº¦ä¸€è‡´</li>
                    <li>çˆ±å¿ƒæŒ‰é’®åœ¨é«˜äº®çŠ¶æ€ä¸‹æ˜¾ç¤ºä¸ºçº¢è‰²</li>
                    <li>ç‚¹å‡»ä¸‹æ‹‰ç®­å¤´å‡å°‘è®¡æ•°ï¼Œç‚¹å‡»çˆ±å¿ƒå®Œå…¨ç§»é™¤é«˜äº®</li>
                    <li>ğŸ†• æ“ä½œå tooltip ä¿æŒæ˜¾ç¤ºï¼ŒæŒ‰é’®é¢œè‰²å®æ—¶æ›´æ–°</li>
                    <li>ğŸ†• å¯ä»¥è¿ç»­æ“ä½œï¼Œæ— éœ€é‡æ–°æ‚¬åœ</li>
                    <li>ğŸ†• é«˜äº®å®Œå…¨ç§»é™¤åï¼ŒæŒ‰é’®å˜ä¸ºç°è‰²ä½†ä»å¯è§</li>
                    <li>ğŸ†• çˆ±å¿ƒæŒ‰é’®æ”¯æŒåˆ‡æ¢ï¼šæœ‰é«˜äº®æ—¶ç§»é™¤ï¼Œæ— é«˜äº®æ—¶æ·»åŠ </li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•æ–‡æœ¬ 1 - å¤šä¸ª JavaScript è¯æ±‡</h3>
            <div class="test-text">
                JavaScript is a versatile programming language. Modern JavaScript frameworks like React and Vue.js make JavaScript development more efficient. Learning JavaScript fundamentals is essential for web development.
            </div>
            <div class="highlight-info">
                ğŸ’¡ è¿™æ®µåŒ…å«4ä¸ª"JavaScript"è¯æ±‡ï¼Œæµ‹è¯•å…¨å±€åŒæ­¥æ›´æ–°åŠŸèƒ½
            </div>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•æ–‡æœ¬ 2 - æ··åˆè¯æ±‡</h3>
            <div class="test-text">
                React is a popular JavaScript library for building user interfaces. TypeScript extends JavaScript by adding static type definitions. Both React and TypeScript are widely used in modern web development.
            </div>
            <div class="highlight-info">
                ğŸ’¡ åŒ…å«å¤šç§è¯æ±‡ï¼Œæµ‹è¯•ä¸åŒé«˜äº®çŠ¶æ€ä¸‹çš„æŒ‰é’®é¢œè‰²
            </div>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•æ–‡æœ¬ 3 - é‡å¤é«˜äº®æµ‹è¯•</h3>
            <div class="test-text">
                CSS is the language we use to style an HTML document. CSS describes how HTML elements should be displayed. CSS can control the layout of multiple web pages all at once.
            </div>
            <div class="highlight-info">
                ğŸ’¡ å¤šæ¬¡é«˜äº®åŒä¸€è¯æ±‡ï¼Œæµ‹è¯•é¢œè‰²æ·±åº¦å˜åŒ–
            </div>
        </div>

        <div class="debug-info">
            <h4>ğŸ” è°ƒè¯•ä¿¡æ¯</h4>
            <p><strong>æ–°åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p>
            <ul>
                <li><strong>çŠ¶æ€æ£€æµ‹ï¼š</strong>è‡ªåŠ¨æ£€æµ‹å½“å‰å•è¯çš„é«˜äº®çŠ¶æ€å’Œè®¡æ•°</li>
                <li><strong>åŠ¨æ€é¢œè‰²ï¼š</strong>æŒ‰é’®é¢œè‰²æ ¹æ®é«˜äº®æ·±åº¦åŠ¨æ€å˜åŒ–</li>
                <li><strong>äº¤äº’æ§åˆ¶ï¼š</strong>ä¸‹æ‹‰ç®­å¤´å‡å°‘è®¡æ•°ï¼Œçˆ±å¿ƒç§»é™¤æ‰€æœ‰é«˜äº®</li>
                <li><strong>å®æ—¶æ›´æ–°ï¼š</strong>æ“ä½œåç«‹å³æ›´æ–°æ‰€æœ‰ç›¸åŒè¯æ±‡çš„é«˜äº®</li>
                <li><strong>ğŸ†• æŒç»­æ˜¾ç¤ºï¼š</strong>æ“ä½œå tooltip ä¿æŒæ˜¾ç¤ºï¼Œæ”¯æŒè¿ç»­æ“ä½œ</li>
                <li><strong>ğŸ†• æ™ºèƒ½åˆ·æ–°ï¼š</strong>æŒ‰é’®çŠ¶æ€å’Œé¢œè‰²å®æ—¶åæ˜ æœ€æ–°çš„é«˜äº®çŠ¶æ€</li>
                <li><strong>ğŸ†• çˆ±å¿ƒåˆ‡æ¢ï¼š</strong>çˆ±å¿ƒæŒ‰é’®æ”¯æŒåŒå‘æ“ä½œï¼ˆæ·»åŠ /ç§»é™¤é«˜äº®ï¼‰</li>
            </ul>

            <p><strong>æ£€æŸ¥æ–¹æ³•ï¼š</strong></p>
            <ul>
                <li>å³é”®ç‚¹å‡»é«˜äº®å…ƒç´  â†’ æ£€æŸ¥å…ƒç´  â†’ æŸ¥çœ‹ data-mark-count å±æ€§</li>
                <li>è§‚å¯Ÿ tooltip æŒ‰é’®çš„é¢œè‰²å˜åŒ–</li>
                <li>æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—</li>
                <li>æµ‹è¯•æŒ‰é’®ç‚¹å‡»åŠŸèƒ½</li>
            </ul>

            <button onclick="showHighlightInfo()">æ˜¾ç¤ºå½“å‰é«˜äº®ä¿¡æ¯</button>
            <button onclick="clearAllHighlights()">æ¸…é™¤æ‰€æœ‰é«˜äº®</button>
            <div id="debug-info" style="margin-top: 10px;"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæµè§ˆå™¨æ‰©å±•ç¯å¢ƒ
        if (typeof browser === 'undefined') {
            window.browser = {
                storage: {
                    local: {
                        get: async (keys) => {
                            const result = {};
                            keys.forEach(key => {
                                const stored = localStorage.getItem(`lucid_${key}`);
                                if (stored) {
                                    result[key] = JSON.parse(stored);
                                }
                            });
                            return result;
                        },
                        set: async (data) => {
                            Object.keys(data).forEach(key => {
                                localStorage.setItem(`lucid_${key}`, JSON.stringify(data[key]));
                            });
                        }
                    }
                }
            };
        }

        function showHighlightInfo() {
            const highlights = document.querySelectorAll('.lucid-highlight');
            const info = Array.from(highlights).map(el => ({
                word: el.dataset.word,
                count: el.dataset.markCount,
                baseColor: el.dataset.baseColor,
                text: el.textContent
            }));

            document.getElementById('debug-info').textContent =
                `å½“å‰é«˜äº®ä¿¡æ¯ (${highlights.length} ä¸ª):\n` +
                JSON.stringify(info, null, 2);
        }

        function clearAllHighlights() {
            document.querySelectorAll('.lucid-highlight').forEach(el => {
                const parent = el.parentNode;
                while (el.firstChild) {
                    parent.insertBefore(el.firstChild, el);
                }
                parent.removeChild(el);
            });
            localStorage.clear();
            document.getElementById('debug-info').textContent = 'æ‰€æœ‰é«˜äº®å·²æ¸…é™¤';
        }

        // ç›‘å¬é«˜äº®å…ƒç´ çš„å˜åŒ–
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList') {
                    mutation.addedNodes.forEach(function(node) {
                        if (node.nodeType === Node.ELEMENT_NODE &&
                            node.classList &&
                            node.classList.contains('lucid-highlight')) {
                            console.log('âœ… æ–°é«˜äº®å…ƒç´ å·²æ·»åŠ :', {
                                word: node.dataset.word,
                                markCount: node.dataset.markCount,
                                element: node
                            });
                        }
                    });
                }

                if (mutation.type === 'attributes' &&
                    mutation.attributeName === 'data-mark-count') {
                    console.log('ğŸ“Š é«˜äº®è®¡æ•°å·²æ›´æ–°:', {
                        word: mutation.target.dataset.word,
                        oldCount: mutation.oldValue,
                        newCount: mutation.target.dataset.markCount,
                        element: mutation.target
                    });
                }
            });
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: true,
            attributeOldValue: true,
            attributeFilter: ['data-mark-count']
        });
    </script>
</body>
</html>
